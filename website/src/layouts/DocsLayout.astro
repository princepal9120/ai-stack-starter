---
import Layout from "./Layout.astro";

interface Props {
  title: string;
  description?: string;
}

const { title, description = "" } = Astro.props;

const sidebar = [
  {
    section: "Getting Started",
    links: [
      { text: "Introduction", href: "/docs" },
      { text: "Quick Start", href: "/docs/quickstart" },
      { text: "Installation", href: "/docs/installation" },
    ],
  },
  {
    section: "Core Concepts",
    links: [
      { text: "Architecture", href: "/docs/architecture" },
      { text: "RAG Pipeline", href: "/docs/rag-pipeline" },
      { text: "LLM Providers", href: "/docs/llm-providers" },
      { text: "Vector Databases", href: "/docs/vector-databases" },
    ],
  },
  {
    section: "Guides",
    links: [{ text: "Use Cases", href: "/docs/use-cases" }],
  },
  {
    section: "Deployment",
    links: [
      { text: "Docker", href: "/docs/deployment" },
      { text: "Kubernetes", href: "/docs/kubernetes" },
    ],
  },
  {
    section: "Resources",
    links: [{ text: "Security", href: "/docs/security" }],
  },
];

const currentPath = Astro.url.pathname;

// Flatten links for prev/next navigation
const allLinks = sidebar.flatMap((group) => group.links);
const currentIndex = allLinks.findIndex(
  (link) => currentPath === link.href || currentPath === link.href + "/"
);
const prevLink = currentIndex > 0 ? allLinks[currentIndex - 1] : null;
const nextLink =
  currentIndex < allLinks.length - 1 ? allLinks[currentIndex + 1] : null;

// Current page info
let currentSection = "";
let currentPage = "Introduction";
for (const group of sidebar) {
  for (const link of group.links) {
    if (currentPath === link.href || currentPath === link.href + "/") {
      currentSection = group.section;
      currentPage = link.text;
    }
  }
}
---

<Layout title={`${title} - AI Stack Docs`}>
  {/* Header */}
  <header
    class="fixed inset-x-0 top-0 z-50 h-16 border-b border-slate-800 bg-slate-950/90 backdrop-blur-xl"
  >
    <div
      class="mx-auto flex h-full max-w-screen-2xl items-center justify-between px-4 lg:px-8"
    >
      <div class="flex items-center gap-6">
        {/* Mobile menu button */}
        <button
          id="mobile-menu-btn"
          class="lg:hidden p-2 -ml-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition"
          aria-label="Toggle menu"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>

        {/* Logo */}
        <a
          href="/"
          class="flex items-center gap-2 text-xl font-bold text-white"
        >
          <span
            class="text-2xl bg-gradient-to-r from-blue-500 to-purple-500 bg-clip-text text-transparent"
            >AI Stack</span
          >
        </a>

        {/* Nav links */}
        <nav class="hidden md:flex items-center gap-1">
          <a
            href="/docs"
            class="px-3 py-1.5 text-sm font-medium text-white bg-slate-800 rounded-lg"
            >Docs</a
          >
          <a
            href="/showcase"
            class="px-3 py-1.5 text-sm font-medium text-slate-400 hover:text-white transition"
            >Showcase</a
          >
          <a
            href="https://github.com/princepal9120/ai-stack"
            class="px-3 py-1.5 text-sm font-medium text-slate-400 hover:text-white transition"
            target="_blank">GitHub</a
          >
        </nav>
      </div>

      <div class="flex items-center gap-3">
        {/* Search button */}
        <button
          class="hidden md:flex items-center gap-2 px-3 py-2 bg-slate-800/50 border border-slate-700 rounded-lg text-slate-400 text-sm hover:border-slate-600 transition"
        >
          <svg
            class="w-4 h-4"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
          <span>Search docs...</span>
          <kbd
            class="ml-2 text-xs border border-slate-600 rounded px-1.5 py-0.5"
            >/</kbd
          >
        </button>

        {/* GitHub link */}
        <a
          href="https://github.com/princepal9120/ai-stack"
          class="p-2 hover:bg-slate-800 rounded-lg transition text-slate-400 hover:text-white"
          target="_blank"
          aria-label="GitHub"
        >
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
            <path
              d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"
            ></path>
          </svg>
        </a>

        {/* Theme toggle */}
        <button
          class="p-2 hover:bg-slate-800 rounded-lg transition text-slate-400 hover:text-white"
          aria-label="Toggle theme"
        >
          <svg
            class="w-5 h-5"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
            ></path>
          </svg>
        </button>
      </div>
    </div>
  </header>

  {/* Mobile Sidebar Overlay */}
  <div
    id="mobile-overlay"
    class="fixed inset-0 z-40 bg-slate-950/80 backdrop-blur-sm hidden lg:hidden"
  >
  </div>

  <div class="flex pt-16">
    {/* Left Sidebar */}
    <aside
      id="sidebar"
      class="fixed left-0 top-16 z-40 h-[calc(100vh-4rem)] w-72 -translate-x-full lg:translate-x-0 overflow-y-auto border-r border-slate-800 bg-slate-950 transition-transform duration-300 ease-in-out"
    >
      <nav class="px-4 pt-6 pb-10 space-y-6">
        {
          sidebar.map((group) => (
            <div>
              <h3 class="font-semibold text-slate-300 text-xs uppercase tracking-wider mb-3 px-2">
                {group.section}
              </h3>
              <ul class="space-y-1">
                {group.links.map((link) => {
                  const isActive =
                    currentPath === link.href ||
                    currentPath === link.href + "/";
                  return (
                    <li>
                      <a
                        href={link.href}
                        class:list={[
                          "block py-2 px-3 text-sm rounded-lg transition-colors",
                          isActive
                            ? "text-white bg-purple-500/20 border-l-2 border-purple-500"
                            : "text-slate-400 hover:text-white hover:bg-slate-800/50",
                        ]}
                      >
                        {link.text}
                      </a>
                    </li>
                  );
                })}
              </ul>
            </div>
          ))
        }
      </nav>
    </aside>

    {/* Main Content */}
    <main class="flex-1 lg:pl-72">
      <div class="mx-auto max-w-4xl px-4 py-8 lg:px-8">
        {/* Breadcrumbs */}
        <nav
          class="flex items-center gap-2 text-sm text-slate-400 mb-6"
          aria-label="Breadcrumb"
        >
          <a href="/" class="hover:text-white transition">
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
              ></path>
            </svg>
          </a>
          <span class="text-slate-600">/</span>
          <a href="/docs" class="hover:text-white transition">Docs</a>
          <span class="text-slate-600">/</span>
          <span class="text-slate-200">{currentPage}</span>
        </nav>

        {/* Content */}
        <article
          class="prose prose-invert prose-slate max-w-none
          prose-headings:font-bold prose-headings:text-white prose-headings:tracking-tight prose-headings:scroll-mt-20
          prose-h1:text-3xl prose-h1:mb-4 prose-h1:bg-gradient-to-r prose-h1:from-white prose-h1:to-slate-300 prose-h1:bg-clip-text
          prose-h2:text-2xl prose-h2:mt-12 prose-h2:mb-4 prose-h2:border-b prose-h2:border-slate-800 prose-h2:pb-3
          prose-h3:text-xl prose-h3:mt-8 prose-h3:mb-3
          prose-p:text-slate-300 prose-p:leading-relaxed
          prose-a:text-purple-400 prose-a:no-underline hover:prose-a:underline prose-a:font-medium
          prose-strong:text-white prose-strong:font-semibold
          prose-code:text-purple-300 prose-code:bg-slate-800/70 prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded prose-code:text-sm prose-code:before:content-none prose-code:after:content-none prose-code:font-normal
          prose-pre:bg-slate-900 prose-pre:border prose-pre:border-slate-800 prose-pre:rounded-xl
          prose-ul:text-slate-300
          prose-ol:text-slate-300
          prose-li:marker:text-purple-500"
        >
          <slot />
        </article>

        {/* Prev/Next Navigation */}
        <nav class="mt-16 pt-8 border-t border-slate-800">
          <div class="flex flex-col sm:flex-row justify-between gap-4">
            {
              prevLink ? (
                <a
                  href={prevLink.href}
                  class="group flex flex-col p-4 border border-slate-800 rounded-xl hover:border-purple-500/50 hover:bg-slate-800/50 transition-all"
                >
                  <span class="text-xs text-slate-500 mb-1">Previous</span>
                  <span class="text-white font-medium group-hover:text-purple-400 transition-colors">
                    ‚Üê {prevLink.text}
                  </span>
                </a>
              ) : (
                <div />
              )
            }

            {
              nextLink && (
                <a
                  href={nextLink.href}
                  class="group flex flex-col p-4 border border-slate-800 rounded-xl hover:border-purple-500/50 hover:bg-slate-800/50 transition-all text-right sm:items-end"
                >
                  <span class="text-xs text-slate-500 mb-1">Next</span>
                  <span class="text-white font-medium group-hover:text-purple-400 transition-colors">
                    {nextLink.text} ‚Üí
                  </span>
                </a>
              )
            }
          </div>
        </nav>

        {/* Footer */}
        <footer class="mt-12 pt-8 border-t border-slate-800">
          <div class="flex flex-wrap gap-6 text-sm">
            <a
              href={`https://github.com/princepal9120/ai-stack/edit/main/website/src/pages${currentPath === "/docs" || currentPath === "/docs/" ? "/docs/index" : currentPath}.astro`}
              class="flex items-center gap-2 text-slate-400 hover:text-white transition"
              target="_blank"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
                ></path>
              </svg>
              Edit this page on GitHub
            </a>
            <a
              href="https://github.com/princepal9120/ai-stack/issues/new"
              class="flex items-center gap-2 text-slate-400 hover:text-white transition"
              target="_blank"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              Report an issue
            </a>
          </div>
        </footer>
      </div>
    </main>

    {/* Right Sidebar (TOC) - Reserved for page-specific TOC */}
    <aside class="hidden xl:block w-64 shrink-0">
      <div class="sticky top-24 py-8 pr-4">
        <slot name="toc" />

        <div class="mt-8 pt-6 border-t border-slate-800">
          <h4 class="text-sm font-semibold text-slate-200 mb-4">Community</h4>
          <nav class="space-y-2 text-sm text-slate-400">
            <a
              href="https://github.com/princepal9120/ai-stack"
              class="flex items-center gap-2 hover:text-white transition"
              target="_blank"
            >
              ‚≠ê Star on GitHub
            </a>
            <a
              href="https://github.com/princepal9120/ai-stack/discussions"
              class="flex items-center gap-2 hover:text-white transition"
              target="_blank"
            >
              üí¨ Discussions
            </a>
          </nav>
        </div>
      </div>
    </aside>
  </div>
</Layout>

<script>
  // Mobile sidebar toggle
  const mobileBtn = document.getElementById("mobile-menu-btn");
  const sidebar = document.getElementById("sidebar");
  const overlay = document.getElementById("mobile-overlay");

  function toggleSidebar() {
    sidebar?.classList.toggle("-translate-x-full");
    overlay?.classList.toggle("hidden");
    document.body.classList.toggle("overflow-hidden");
  }

  mobileBtn?.addEventListener("click", toggleSidebar);
  overlay?.addEventListener("click", toggleSidebar);

  // Close on escape
  document.addEventListener("keydown", (e) => {
    if (
      e.key === "Escape" &&
      !sidebar?.classList.contains("-translate-x-full")
    ) {
      toggleSidebar();
    }
  });
</script>
